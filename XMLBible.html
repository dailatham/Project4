
<!-- XMLBible.html
 -- James Skon: original version April 2011
 -- Bob Kasper: revised March 2021
 -- Mount Vernon Nazarene University
 -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>XML Bible | Daisy Latham</title>
<script type="text/javascript">
function setup() {
  if (window.XMLHttpRequest)
    {// code for IE7+, Firefox, Chrome, Opera, Safari
    xmlhttp = new XMLHttpRequest();
    }
  else
    {// code for IE6, IE5
    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
  // location of XML Bible files, must be on same web server
  // that hosts this web page to avoid Cross-Domain request restrictions
  biblePath = "/class/csc3004/XMLBible/"
}

function getresponse () {
  // read input values from user
  var bv = document.getElementById('version').value;
  var b = document.getElementById('book').value;
  var c = document.getElementById('chapter').value === '' ? 1 : document.getElementById('chapter').value;
  var v = document.getElementById('verse').value === '' ? 1 : parseInt(document.getElementById('verse').value);
  var nv = document.getElementById('nv').value === '' ? 1 : parseInt(document.getElementById('nv').value);
  var useStrongs = document.getElementById('use_strongs').checked;

  // TODO: add code to select a version of the Bible based on user input
  // (only KJV and WEB versions are available with XML files)
  
  // add code to select a version of the Bible based on user input
  var XMLBook;
  if (bv == "kjv") {
    XMLBook = biblePath + "kjv_by_book/" + b + ".xml";
  } else {
    XMLBook = biblePath + "web_by_book/" + b + ".xml";
  }

  xmlhttp.open("GET",XMLBook,false);
  xmlhttp.send();
  xmlDoc = xmlhttp.responseXML;

  var bookInfo = "<h6>Book retrieved from file: " + XMLBook + "</h6>";
  document.all.headArea.innerHTML = "<h1><font color=blue>XML Bible Demo Output</font></h1>"
									+ bookInfo;
  try {
    document.all.responseArea.innerHTML = " ";
    vtext = getVerse(b,c,v);
	document.all.responseArea.innerHTML += "<p>" +vtext+ "</p>";

	// for multi
	for(var i = 1; i<nv; i++){
		v++
		vtext = getVerse(b,c,v);
		document.all.responseArea.innerHTML += "<p>" +vtext+ "</p>";		
	}
  }
  catch(error) {
    if (error == "no chapter") {
      var book = xmlDoc.getElementsByTagName("book")[0].getAttribute("name");
      document.all.responseArea.innerHTML += "<b><i>No such chapter " +c+ "</i></b>";
    }      
    if (error == "no verse") {
      var book = xmlDoc.getElementsByTagName("book")[0].getAttribute("name");
      document.all.responseArea.innerHTML += "<b><i>No such verse " +v+ "</i></b>";
    }
  } 
} // end getResponse

function getVerse(book,chapter,verse) {
  var verseOutput = xmlDoc.getElementsByTagName("book")[0].getAttribute("name"); 
  var c = xmlDoc.getElementsByTagName("chapter")[chapter-1];
  if (c==null)
	throw "no chapter";
  verseOutput += " ";
  verseOutput += c.getAttribute("number"); 
  var v = c.getElementsByTagName("verse")[verse-1]
  if (v==null)
	throw "no verse";
  verseOutput += ":";
  verseOutput += v.getAttribute("number");
  verseOutput += " ";
  for (j=0; j < v.childNodes.length; j++) {
	var nodeStr = getNodeString(v.childNodes[j]);
	verseOutput += nodeStr;
  }
  return(verseOutput);
} // end getVerse

function getNodeString(node) {
	var isStrong = document.getElementById('use_strongs').checked;
	var result = "";
	if (node.nodeType == 3) { // type 3: text node
		result += node.nodeValue;
		result += " ";
	} 
	if (node.nodeType == 1) { // type 1: tag
		if (node.nodeName == "em") {
		   result += "<i>";
		   result += node.childNodes[0].nodeValue;
		   result += "</i> ";
		}
		else if (node.nodeName == "STYLE") {
		   result += '<span style="' + node.getAttribute("css") + '">';
		   for (n=0; n < node.childNodes.length; n++) {
				var nodeStr = getNodeString(node.childNodes[n]);
				result += nodeStr;
			}
		   result += "</span> ";
		}
		else if (node.nodeName=="strongs") {
		   if (node.childNodes[0] != null) {
		     // show the text of the word that is inside the strong tag
			 result += node.childNodes[0].nodeValue;
		   }
		   // TO DO: use hasAttribute(attributename) to determine
		   // if the strongs tag has attributes named hebrew, greek, or number
		   // When the attribute exists, add the strong number to the HTML result
		   // as the contents of a <sub> tag, which will display it as a subscript
		   // after the word.
		   // When hebrew, or greek attribute exists, add the strong 

		   if (isStrong && (node.hasAttribute("hebrew") || node.hasAttribute("greek"))) {
			var lexID = node.getAttribute(node.hasAttribute("hebrew") ? "hebrew" : "greek");
	  		result += "<a href='javascript:alert(" + lexID + ")'>";
  			result += "<i><font size=1 color=blue><sub>";
  			result += node.getAttribute(node.hasAttribute("hebrew") ? "hebrew" : "greek");
  			result += "</sub></font></i></a> ";
		   } else {
	  		result += " ";
		   }
		}
	}
	return(result);
} // end getNodeString
</script>
</head>

<body onLoad="setup()">
<form onsubmit="return false"> <!-- submit button defines handler below:
                                    onclick="javascript: getresponse()" -->
<h1>Bible Search from XML files</h1>
<table>
<TR>

<!--Add bible version opition here.-->
<TD ALIGN=RIGHT VALIGN=TOP>Book Version</TD>
<TD ALIGN=LEFT VALIGN=TOP>
<SELECT NAME="version" id=version>
<OPTION VALUE="kjv">The King James Version
<OPTION VALUE="web">The World English Bible
</SELECT>
</TD>
</TR>

<!--For the book -->
<TR>
<TD ALIGN=RIGHT VALIGN=TOP>Book</TD>
<TD ALIGN=LEFT VALIGN=TOP>
        <select name="book" id="book">
          <option value="1">Genesis</option>
          <option value="2">Exodus</option>
          <option value="3">Leviticus</option>
          <option value="4">Numbers</option>
          <option value="5">Deuteronomy</option>
          <option value="6">Joshua</option>
          <option value="7">Judges</option>
          <option value="8">Ruth</option>
          <option value="9">1 Samuel</option>
          <option value="10">2 Samuel</option>
          <option value="11">1 Kings</option>
          <option value="12">2 Kings</option>
          <option value="13">1 Chronicles</option>
          <option value="14">2 Chronicles</option>
          <option value="15">Ezra</option>
          <option value="16">Nehemiah</option>
          <option value="17">Esther</option>
          <option value="18">Job</option>
          <option value="19">Psalm</option>
          <option value="20">Proverbs</option>
          <option value="21">Ecclesiastes</option>
          <option value="22">Song of Solomon</option>
          <option value="23">Isaiah</option>
          <option value="24">Jeremiah</option>
          <option value="25">Lamentations</option>
          <option value="26">Ezekiel</option>
          <option value="27">Daniel</option>
          <option value="28">Hosea</option>
          <option value="29">Joel</option>
          <option value="30">Amos</option>
          <option value="31">Obadiah</option>
          <option value="32">Jonah</option>
          <option value="33">Micah</option>
          <option value="34">Nahum</option>
          <option value="35">Habakkuk</option>
          <option value="36">Zephaniah</option>
          <option value="37">Haggai</option>
          <option value="38">Zechariah</option>
          <option value="39">Malachi</option>
          <option value="40">Matthew</option>
          <option value="41">Mark</option>
          <option value="42">Luke</option>
          <option value="43">John</option>
          <option value="44">Acts</option>
          <option value="45">Romans</option>
          <option value="46">1 Corinthians</option>
          <option value="47">2 Corinthians</option>
          <option value="48">Galatians</option>
          <option value="49">Ephesians</option>
          <option value="50">Philippians</option>
          <option value="51">Colossians</option>
          <option value="52">1 Thessalonians</option>
          <option value="53">2 Thessalonians</option>
          <option value="54">1 Timothy</option>
          <option value="55">2 Timothy</option>
          <option value="56">Titus</option>
          <option value="57">Philemon</option>
          <option value="58">Hebrews</option>
          <option value="59">James</option>
          <option value="60">1 Peter</option>
          <option value="61">2 Peter</option>
          <option value="62">1 John</option>
          <option value="63">2 John</option>
          <option value="64">3 John</option>
          <option value="65">Jude</option>
          <option value="66">Revelation</option>
        </select>
</TD>
</TR>


<!--For the book number-->
<!-- 
<TR>
<TD ALIGN=RIGHT VALIGN=TOP>Book Number</TD>
<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="book1" TYPE="text" MAXLENGTH=2  id=book1></TD>
</TR>
-->

<!--For the chapter number-->
<TR>
<TD ALIGN=RIGHT VALIGN=TOP>Chapter</TD>
<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="chapter" TYPE="text" MAXLENGTH=3  id=chapter></TD>
</TR>

<!--For the verse number-->
<TR>
<TD ALIGN=RIGHT VALIGN=TOP>Verse</TD>
<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="verse" TYPE="text" MAXLENGTH=3 id=verse></TD>
</TR>

<!--For the number of verse-->
<TR>
<TD ALIGHN=RIGHT VALIGN=TOP>Number of verses</TD>
<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="nv" TYPE="text" MAXLENGTH=3 id=nv></TD>
</TR>

<!--For lexicon checkbox-->
<TR>
<TD ALIGN=RIGHT VALIGN=TOP>Use Lexicon</TD>
<TD ALIGN=LEFT VALIGN=TOP><input type="checkbox" name="use_strongs" id="use_strongs">

<!--For submit-->
</table>
<p>
<input type="submit" onclick="javascript: getresponse()" name="submit" value="Submit" />
</p>
</form>
<div id = "headArea">
</div>
<div id = "responseArea">
</div>
</body>
</html>
